System Summary: Fact Viewer

1. High-Level Concept:
   * The Fact Viewer is a graphical user interface (GUI) component designed to provide a visual representation and management interface for the structured facts stored by the Fact Manager. It allows users to inspect, update, and delete individual facts associated with a specific project, offering transparency into the "story brain" or "world state" maintained by the system.

2. Core Components:
   * Frontend (views/fact_viewer/renderer_facts.js):
     * Responsible for rendering the facts data in a user-friendly table format, grouped by turn (chapterId).
     * Handles user interactions such as clicking "Save" or "Delete" buttons for individual facts.
     * Communicates with the backend (main.js) via Socket.IO to request facts and send modification commands.
   * Backend (main.js - factHandlers):
     * Manages the server-side logic for the Fact Viewer.
     * Handles Socket.IO events from the frontend:
       * `get-all-facts`: Requests all facts for the currently active project from the Fact Manager.
       * `update-fact`: Receives updated fact data from the frontend and calls `Fact_Manager.updateFact` to persist changes to the database.
       * `delete-fact`: Receives a fact ID from the frontend and calls `Fact_Manager.deleteFact` to remove the fact from the database.
     * Emits responses back to the frontend to confirm operations or provide data.

3. Workflow:
   * Initialization:
     * Upon loading, the Fact Viewer frontend connects to the backend via Socket.IO.
     * It requests the current project name from the backend (`get-current-project-name`).
     * Once the project name is received, it triggers the loading of facts for that project.
   * Fact Retrieval and Display:
     * The frontend emits a `get-all-facts` event to the backend, providing the current `projectName`.
     * The backend's `handleGetAllFacts` function calls `Fact_Manager.getAllFactsGroupedByTurn` with the provided `projectName`.
     * The retrieved facts are sent back to the frontend via `get-all-facts-response`.
     * The `renderFacts` function in `renderer_facts.js` then populates the GUI with the received data, grouping facts by their `chapterId`.
   * Fact Modification (Update/Delete):
     * When a user clicks "Save" or "Delete" on a fact row, the frontend emits `update-fact` or `delete-fact` events, respectively, along with the fact's ID and any updated data.
     * The backend's `handleUpdateFact` or `handleDeleteFact` functions call the corresponding `Fact_Manager` methods (`updateFact`, `deleteFact`) to modify the database.
     * Success or failure responses are sent back to the frontend, which updates the UI accordingly (e.g., visual feedback, removing deleted rows).

4. Key Interactions:
   * The `projectName` field is critical for all operations. It ensures that facts are retrieved, updated, or deleted only within the context of the currently active project.
   * Consistency in `projectName` usage across the frontend, backend, and the SQLite database is paramount for the Fact Viewer to display accurate and relevant data.

5. Troubleshooting (Common Issue):
   * Historically, a common issue was that facts might have been stored with a `projectName` of 'default' even when a specific project was active. This was due to a missing `projectName` parameter in certain `Fact_Manager` function calls (specifically `extractAndStoreFacts` from `vnmanager.js`).
   * This has been addressed by a recent code fix, ensuring that new facts are correctly associated with the active project.
   

6. Intended Application and Purpose:
   * Provides a debugging and inspection tool for developers and users to verify the accuracy and completeness of the extracted world state and character personality facts.
   * Allows for direct manipulation of facts, enabling manual corrections or adjustments to the story's underlying data.
   * Enhances transparency into the system's internal memory representation, aiding in understanding and refining the AI's narrative generation process.